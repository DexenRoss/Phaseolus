generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  COLLABORATOR
  ADMIN
}

model User {
  id           BigInt @id @default(autoincrement()) @db.UnsignedBigInt
  firstName    String @map("first_name") @db.VarChar(60)
  lastName     String @map("last_name") @db.VarChar(60)
  email        String @unique @db.VarChar(150)
  passwordHash String @map("password_hash") @db.VarChar(255)

  role Role @default(USER)

  organization String? @db.VarChar(120)
  isActive     Boolean @default(true) @map("is_active")

  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  emailVerifiedAt DateTime? @map("email_verified_at")

  emailVerificationTokens EmailVerificationToken[]

  @@index([role])
  @@index([isActive])
  @@map("users")
}

model CollaboratorInvite {
  id    String @id @default(cuid())
  email String @db.VarChar(150)

  // Guardamos HASH del token (seguridad). El token real solo vive en el link del correo.
  tokenHash String @unique @db.VarChar(64)

  expiresAt DateTime
  usedAt    DateTime?

  role Role @default(COLLABORATOR)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([expiresAt])
  @@map("collaborator_invites")
}

model EmailVerificationToken {
  id        String    @id @default(cuid())
  userId    BigInt    @db.UnsignedBigInt
  tokenHash String    @unique @db.VarChar(64)
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("email_verification_tokens")
}
